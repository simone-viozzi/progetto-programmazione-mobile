package com.example.receiptApp.utils

import android.content.ContentResolver
import android.content.ContentUris
import android.graphics.Bitmap
import android.graphics.BitmapFactory
import android.net.Uri
import android.os.Build
import android.provider.MediaStore
import android.util.Size
import com.example.receiptApp.THUMBNAIL_SIZE
import timber.log.Timber
import java.io.FileNotFoundException

class ImageUtils
{
    companion object {
        /**
         * Get thumbnail from the uri of an image
         *
         * @param contentResolver
         * @param uri
         * @param id -> if SDK < Q need to use old method
         * @return -> the bitmap or null if not found
         */
        fun getThumbnail(contentResolver: ContentResolver, uri: Uri, id: Long? = null): Bitmap?
        {
            return try
            {
                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q)
                {
                    contentResolver.loadThumbnail(
                        uri, Size(THUMBNAIL_SIZE, THUMBNAIL_SIZE), null
                    )
<<<<<<< HEAD
                } else {
                    if (contentUri.scheme == "content") {

                        Timber.d("$contentUri")
                        Timber.d("contentUri.lastPathSegment -> ${ContentUris.parseId(contentUri)}")
=======
                } else
                {
                    if (uri.scheme == "content")
                    {
                        Timber.d("$uri")
                        Timber.d("contentUri.lastPathSegment -> ${ContentUris.parseId(uri)}")
>>>>>>> bee23d595be2d70cb5bb97c3e1fcaab8310475be
                        MediaStore.Images.Thumbnails.getThumbnail(
                            contentResolver,
                            id ?: ContentUris.parseId(uri),
                            MediaStore.Images.Thumbnails.MINI_KIND,
                            BitmapFactory.Options()
                        )
                    }
                    else
                    {
                        MediaStore.Images.Media.getBitmap(contentResolver, uri)
                    }
                }
            } catch (e: FileNotFoundException)
            {
                Timber.e("$uri not found")
                null
            }
        }

    }
}